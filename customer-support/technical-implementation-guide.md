# Technical Implementation Guide - Customer Support App with AI

## Lab 1: Configure AI Service

### OCI Generative AI Setup
1. Navigate to Workspace Utilities → Generative AI
2. Click Create Generative AI Service
3. Service Type: OCI Generative AI
4. Name: OCI_GEN_AI
5. Description: OCI Generative AI Service
6. Tenancy OCID: [Your OCID]
7. User OCID: [Your User OCID]
8. Private Key: [Upload .pem file]
9. Fingerprint: [Your fingerprint]
10. Region: [Your region]
11. Compartment OCID: [Your compartment OCID]
12. Test Connection
13. Enable "Used by App Builder"

### OpenAI Setup (Alternative)
1. Service Type: OpenAI
2. Name: OPENAI_SERVICE
3. API Key: [Your OpenAI API Key]
4. Test Connection
5. Enable "Used by App Builder"

## Lab 2: Data Model Creation

### Generate Data Model with AI
1. SQL Workshop → Utilities → Create Data Model Using AI
2. Accept AI consent
3. Prompt 1: "Create a data model for customer support app for a retail bank with entities for Customers, their Accounts, and the Support Tickets opened for those customers."
4. Prompt 2: "Add supporting entities for Service Requests, SLA tracking on each ticket, and the customer channels for support interactions."
5. Prompt 3: "Prefix all objects with cs_"
6. Generate SQL script

### Generate Sample Data
1. Use APEX Assistant
2. Prompt: "Generate sample data for all tables"
3. Replace generated script with complete data model:

```sql
-- ============================================================================
-- TABLE: cs_customers
-- ============================================================================
CREATE TABLE cs_customers (
    customer_id       NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY
                      CONSTRAINT cs_customers_id_pk PRIMARY KEY,
    customer_name     VARCHAR2(255 CHAR) NOT NULL,
    customer_type     VARCHAR2(50 CHAR) DEFAULT 'Individual' 
                      CONSTRAINT cs_customers_type_chk 
                      CHECK (customer_type IN ('Individual', 'Corporate')),
    email             VARCHAR2(255 CHAR),
    mobile            VARCHAR2(50 CHAR),
    kyc_status        VARCHAR2(50 CHAR) DEFAULT 'Pending'
                      CONSTRAINT cs_customers_kyc_chk 
                      CHECK (kyc_status IN ('Pending', 'Verified', 'Rejected')),
    created_at        DATE NOT NULL,
    created_by        VARCHAR2(255 CHAR) NOT NULL,
    updated_at        DATE NOT NULL,
    updated_by        VARCHAR2(255 CHAR) NOT NULL
);

-- ============================================================================
-- TABLE: cs_accounts
-- ============================================================================
CREATE TABLE cs_accounts (
    account_id              NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY
                            CONSTRAINT cs_accounts_id_pk PRIMARY KEY,
    customer_id             NUMBER NOT NULL
                            CONSTRAINT cs_accounts_customer_id_fk
                            REFERENCES cs_customers,
    account_number_masked   VARCHAR2(50 CHAR) NOT NULL,
    account_type            VARCHAR2(50 CHAR) NOT NULL
                            CONSTRAINT cs_accounts_type_chk 
                            CHECK (account_type IN ('Savings', 'Current', 'Loan', 'Credit Card', 'Fixed Deposit')),
    status                  VARCHAR2(50 CHAR) DEFAULT 'Active'
                            CONSTRAINT cs_accounts_status_chk 
                            CHECK (status IN ('Active', 'Inactive', 'Blocked', 'Closed')),
    created_at              DATE NOT NULL,
    created_by              VARCHAR2(255 CHAR) NOT NULL,
    updated_at              DATE NOT NULL,
    updated_by              VARCHAR2(255 CHAR) NOT NULL
);

CREATE INDEX cs_accounts_i1 ON cs_accounts (customer_id);

-- ============================================================================
-- TABLE: cs_agents
-- ============================================================================
CREATE TABLE cs_agents (
    agent_id          NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY
                      CONSTRAINT cs_agents_id_pk PRIMARY KEY,
    agent_name        VARCHAR2(255 CHAR) NOT NULL,
    email             VARCHAR2(255 CHAR) NOT NULL,
    role              VARCHAR2(50 CHAR) DEFAULT 'L1'
                      CONSTRAINT cs_agents_role_chk 
                      CHECK (role IN ('L1', 'L2', 'Supervisor', 'Manager')),
    active_flag       VARCHAR2(1 CHAR) DEFAULT 'Y'
                      CONSTRAINT cs_agents_active_chk 
                      CHECK (active_flag IN ('Y', 'N')),
    created_at        DATE NOT NULL,
    created_by        VARCHAR2(255 CHAR) NOT NULL,
    updated_at        DATE NOT NULL,
    updated_by        VARCHAR2(255 CHAR) NOT NULL
);

-- ============================================================================
-- TABLE: cs_tickets
-- ============================================================================
CREATE TABLE cs_tickets (
    ticket_id           NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY
                        CONSTRAINT cs_tickets_id_pk PRIMARY KEY,
    ticket_number       VARCHAR2(50 CHAR) NOT NULL UNIQUE,
    customer_id         NUMBER NOT NULL
                        CONSTRAINT cs_tickets_customer_id_fk
                        REFERENCES cs_customers,
    account_id          NUMBER
                        CONSTRAINT cs_tickets_account_id_fk
                        REFERENCES cs_accounts,
    subject             VARCHAR2(500 CHAR) NOT NULL,
    description         VARCHAR2(4000 CHAR),
    priority            VARCHAR2(20 CHAR) DEFAULT 'Medium'
                        CONSTRAINT cs_tickets_priority_chk 
                        CHECK (priority IN ('Low', 'Medium', 'High', 'Critical')),
    status              VARCHAR2(50 CHAR) DEFAULT 'New'
                        CONSTRAINT cs_tickets_status_chk 
                        CHECK (status IN ('New', 'In Progress', 'Waiting', 'Resolved', 'Closed', 'Cancelled')),
    channel             VARCHAR2(50 CHAR) DEFAULT 'Email'
                        CONSTRAINT cs_tickets_channel_chk 
                        CHECK (channel IN ('Phone', 'Email', 'Chat', 'Branch', 'Mobile App', 'Web')),
    assigned_agent_id   NUMBER
                        CONSTRAINT cs_tickets_agent_id_fk
                        REFERENCES cs_agents,
    created_at          DATE NOT NULL,
    created_by          VARCHAR2(255 CHAR) NOT NULL,
    updated_at          DATE NOT NULL,
    updated_by          VARCHAR2(255 CHAR) NOT NULL,
    closed_at           DATE
);

CREATE INDEX cs_tickets_i1 ON cs_tickets (customer_id);
CREATE INDEX cs_tickets_i2 ON cs_tickets (account_id);
CREATE INDEX cs_tickets_i3 ON cs_tickets (assigned_agent_id);
CREATE INDEX cs_tickets_i4 ON cs_tickets (status);
CREATE INDEX cs_tickets_i5 ON cs_tickets (priority);
CREATE INDEX cs_tickets_i6 ON cs_tickets (created_at);

-- ============================================================================
-- TABLE: cs_ticket_updates
-- ============================================================================
CREATE TABLE cs_ticket_updates (
    update_id         NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY
                      CONSTRAINT cs_ticket_updates_id_pk PRIMARY KEY,
    ticket_id         NUMBER NOT NULL
                      CONSTRAINT cs_ticket_updates_ticket_id_fk
                      REFERENCES cs_tickets,
    update_text       VARCHAR2(4000 CHAR) NOT NULL,
    updated_by        VARCHAR2(255 CHAR) NOT NULL,
    updated_at        DATE NOT NULL
);

CREATE INDEX cs_ticket_updates_i1 ON cs_ticket_updates (ticket_id);
CREATE INDEX cs_ticket_updates_i2 ON cs_ticket_updates (updated_at);

-- ============================================================================
-- TABLE: cs_interactions
-- ============================================================================
CREATE TABLE cs_interactions (
    interaction_id    NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY
                      CONSTRAINT cs_interactions_id_pk PRIMARY KEY,
    ticket_id         NUMBER NOT NULL
                      CONSTRAINT cs_interactions_ticket_id_fk
                      REFERENCES cs_tickets,
    channel           VARCHAR2(50 CHAR) NOT NULL
                      CONSTRAINT cs_interactions_channel_chk 
                      CHECK (channel IN ('Call', 'Chat', 'Email', 'SMS', 'Branch')),
    message_text      VARCHAR2(4000 CHAR),
    direction         VARCHAR2(20 CHAR) DEFAULT 'Inbound'
                      CONSTRAINT cs_interactions_direction_chk 
                      CHECK (direction IN ('Inbound', 'Outbound')),
    created_at        DATE NOT NULL,
    created_by        VARCHAR2(255 CHAR) NOT NULL
);

CREATE INDEX cs_interactions_i1 ON cs_interactions (ticket_id);
CREATE INDEX cs_interactions_i2 ON cs_interactions (created_at);

-- ============================================================================
-- TABLE: cs_sla
-- ============================================================================
CREATE TABLE cs_sla (
    sla_id              NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY
                        CONSTRAINT cs_sla_id_pk PRIMARY KEY,
    ticket_id           NUMBER NOT NULL UNIQUE
                        CONSTRAINT cs_sla_ticket_id_fk
                        REFERENCES cs_tickets,
    response_due_at     DATE NOT NULL,
    resolution_due_at   DATE NOT NULL,
    sla_status          VARCHAR2(20 CHAR) DEFAULT 'On Track'
                        CONSTRAINT cs_sla_status_chk 
                        CHECK (sla_status IN ('On Track', 'At Risk', 'Breached')),
    created_at          DATE NOT NULL,
    created_by          VARCHAR2(255 CHAR) NOT NULL,
    updated_at          DATE NOT NULL,
    updated_by          VARCHAR2(255 CHAR) NOT NULL
);

CREATE INDEX cs_sla_i1 ON cs_sla (sla_status);

-- ============================================================================
-- TRIGGERS
-- ============================================================================

CREATE OR REPLACE TRIGGER cs_customers_biu BEFORE INSERT OR UPDATE ON cs_customers
FOR EACH ROW
BEGIN
    IF INSERTING THEN
        :new.created_at := SYSDATE;
        :new.created_by := COALESCE(SYS_CONTEXT('APEX$SESSION','APP_USER'), USER);
    END IF;
    :new.updated_at := SYSDATE;
    :new.updated_by := COALESCE(SYS_CONTEXT('APEX$SESSION','APP_USER'), USER);
END;
/

CREATE OR REPLACE TRIGGER cs_accounts_biu BEFORE INSERT OR UPDATE ON cs_accounts
FOR EACH ROW
BEGIN
    IF INSERTING THEN
        :new.created_at := SYSDATE;
        :new.created_by := COALESCE(SYS_CONTEXT('APEX$SESSION','APP_USER'), USER);
    END IF;
    :new.updated_at := SYSDATE;
    :new.updated_by := COALESCE(SYS_CONTEXT('APEX$SESSION','APP_USER'), USER);
END;
/

CREATE OR REPLACE TRIGGER cs_agents_biu BEFORE INSERT OR UPDATE ON cs_agents
FOR EACH ROW
BEGIN
    IF INSERTING THEN
        :new.created_at := SYSDATE;
        :new.created_by := COALESCE(SYS_CONTEXT('APEX$SESSION','APP_USER'), USER);
    END IF;
    :new.updated_at := SYSDATE;
    :new.updated_by := COALESCE(SYS_CONTEXT('APEX$SESSION','APP_USER'), USER);
END;
/

CREATE OR REPLACE TRIGGER cs_tickets_biu BEFORE INSERT OR UPDATE ON cs_tickets
FOR EACH ROW
BEGIN
    IF INSERTING THEN
        :new.created_at := SYSDATE;
        :new.created_by := COALESCE(SYS_CONTEXT('APEX$SESSION','APP_USER'), USER);
        IF :new.ticket_number IS NULL THEN
            :new.ticket_number := 'TICKET-' || TO_CHAR(SYSDATE, 'YYYYMMDD') || '-' || :new.ticket_id;
        END IF;
    END IF;
    :new.updated_at := SYSDATE;
    :new.updated_by := COALESCE(SYS_CONTEXT('APEX$SESSION','APP_USER'), USER);
    IF :new.status IN ('Closed', 'Resolved') AND :old.status NOT IN ('Closed', 'Resolved') THEN
        :new.closed_at := SYSDATE;
    END IF;
END;
/

CREATE OR REPLACE TRIGGER cs_sla_biu BEFORE INSERT OR UPDATE ON cs_sla
FOR EACH ROW
BEGIN
    IF INSERTING THEN
        :new.created_at := SYSDATE;
        :new.created_by := COALESCE(SYS_CONTEXT('APEX$SESSION','APP_USER'), USER);
    END IF;
    :new.updated_at := SYSDATE;
    :new.updated_by := COALESCE(SYS_CONTEXT('APEX$SESSION','APP_USER'), USER);
END;
/

CREATE OR REPLACE TRIGGER cs_ticket_updates_biu BEFORE INSERT OR UPDATE ON cs_ticket_updates
FOR EACH ROW
BEGIN
    :new.updated_at := SYSDATE;
    IF :new.updated_by IS NULL THEN
        :new.updated_by := COALESCE(SYS_CONTEXT('APEX$SESSION','APP_USER'), USER);
    END IF;
END;
/

CREATE OR REPLACE TRIGGER cs_interactions_biu BEFORE INSERT OR UPDATE ON cs_interactions
FOR EACH ROW
BEGIN
    IF INSERTING THEN
        :new.created_at := SYSDATE;
        :new.created_by := COALESCE(SYS_CONTEXT('APEX$SESSION','APP_USER'), USER);
    END IF;
    :new.created_at := NVL(:new.created_at, SYSDATE);
    :new.created_by := NVL(:new.created_by, COALESCE(SYS_CONTEXT('APEX$SESSION','APP_USER'), USER));
END;
/

-- ============================================================================
-- SAMPLE DATA
-- ============================================================================

INSERT INTO cs_customers (customer_id, customer_name, customer_type, email, mobile, kyc_status)
VALUES (1, 'Alice Smith', 'Individual', 'alice@example.com', '9123450001', 'Verified');

INSERT INTO cs_customers (customer_id, customer_name, customer_type, email, mobile, kyc_status)
VALUES (2, 'Beta Ltd.', 'Corporate', 'contact@betaltd.com', '9123450002', 'Pending');

INSERT INTO cs_customers (customer_id, customer_name, customer_type, email, mobile, kyc_status)
VALUES (3, 'Charlie Brown', 'Individual', 'charlie.b@example.com', '9123450003', 'Verified');

INSERT INTO cs_customers (customer_id, customer_name, customer_type, email, mobile, kyc_status)
VALUES (4, 'Delta Corp', 'Corporate', 'help@delta.com', '9123450004', 'Rejected');

INSERT INTO cs_customers (customer_id, customer_name, customer_type, email, mobile, kyc_status)
VALUES (5, 'Eve Miller', 'Individual', 'eve.m@gmail.com', '9123450005', 'Pending');

INSERT INTO cs_customers (customer_id, customer_name, customer_type, email, mobile, kyc_status)
VALUES (6, 'Foxtrot Group', 'Corporate', 'service@foxtrot.com', '9123450006', 'Verified');

INSERT INTO cs_customers (customer_id, customer_name, customer_type, email, mobile, kyc_status)
VALUES (7, 'Grace Hopper', 'Individual', 'grace.hopper@example.com', '9123450007', 'Verified');

INSERT INTO cs_customers (customer_id, customer_name, customer_type, email, mobile, kyc_status)
VALUES (8, 'Hotel Inc.', 'Corporate', 'info@hotelinc.com', '9123450008', 'Pending');

INSERT INTO cs_customers (customer_id, customer_name, customer_type, email, mobile, kyc_status)
VALUES (9, 'Ivy Lane', 'Individual', 'ivy.lane@example.com', '9123450009', 'Rejected');

INSERT INTO cs_customers (customer_id, customer_name, customer_type, email, mobile, kyc_status)
VALUES (10, 'Juliet Test', 'Individual', 'juliet@test.com', '9123450010', 'Verified');

INSERT INTO cs_accounts (account_id, customer_id, account_number_masked, account_type, status)
VALUES (1, 1, 'XXXX-1234', 'Savings', 'Active');

INSERT INTO cs_accounts (account_id, customer_id, account_number_masked, account_type, status)
VALUES (2, 2, 'XXXX-5678', 'Current', 'Active');

INSERT INTO cs_accounts (account_id, customer_id, account_number_masked, account_type, status)
VALUES (3, 3, 'XXXX-2345', 'Loan', 'Blocked');

INSERT INTO cs_accounts (account_id, customer_id, account_number_masked, account_type, status)
VALUES (4, 4, 'XXXX-6789', 'Credit Card', 'Active');

INSERT INTO cs_accounts (account_id, customer_id, account_number_masked, account_type, status)
VALUES (5, 5, 'XXXX-3456', 'Fixed Deposit', 'Inactive');

INSERT INTO cs_accounts (account_id, customer_id, account_number_masked, account_type, status)
VALUES (6, 6, 'XXXX-7890', 'Savings', 'Closed');

INSERT INTO cs_accounts (account_id, customer_id, account_number_masked, account_type, status)
VALUES (7, 7, 'XXXX-4567', 'Current', 'Active');

INSERT INTO cs_accounts (account_id, customer_id, account_number_masked, account_type, status)
VALUES (8, 8, 'XXXX-8901', 'Loan', 'Active');

INSERT INTO cs_accounts (account_id, customer_id, account_number_masked, account_type, status)
VALUES (9, 9, 'XXXX-5678', 'Credit Card', 'Inactive');

INSERT INTO cs_accounts (account_id, customer_id, account_number_masked, account_type, status)
VALUES (10, 10, 'XXXX-1234', 'Savings', 'Active');

INSERT INTO cs_agents (agent_id, agent_name, email, role, active_flag)
VALUES (1, 'Rita Rao', 'rita.rao@org.com', 'L1', 'Y');

INSERT INTO cs_agents (agent_id, agent_name, email, role, active_flag)
VALUES (2, 'Vikas Sharma', 'vikas.sharma@org.com', 'L2', 'Y');

INSERT INTO cs_agents (agent_id, agent_name, email, role, active_flag)
VALUES (3, 'Sunita Patel', 'sunita.patel@org.com', 'Supervisor', 'Y');

INSERT INTO cs_agents (agent_id, agent_name, email, role, active_flag)
VALUES (4, 'Alex King', 'alex.king@org.com', 'L1', 'Y');

INSERT INTO cs_agents (agent_id, agent_name, email, role, active_flag)
VALUES (5, 'Edna Knight', 'edna.knight@org.com', 'Manager', 'Y');

INSERT INTO cs_agents (agent_id, agent_name, email, role, active_flag)
VALUES (6, 'Parul Mehta', 'parul.mehta@org.com', 'L2', 'N');

INSERT INTO cs_agents (agent_id, agent_name, email, role, active_flag)
VALUES (7, 'Mohit Jain', 'mohit.jain@org.com', 'L1', 'Y');

INSERT INTO cs_agents (agent_id, agent_name, email, role, active_flag)
VALUES (8, 'Tina Das', 'tina.das@org.com', 'Supervisor', 'Y');

INSERT INTO cs_agents (agent_id, agent_name, email, role, active_flag)
VALUES (9, 'Priya S', 'priya.s@org.com', 'L1', 'Y');

INSERT INTO cs_agents (agent_id, agent_name, email, role, active_flag)
VALUES (10, 'Sunil Menon', 'sunil.menon@org.com', 'L2', 'Y');

INSERT INTO cs_tickets (ticket_id, ticket_number, customer_id, account_id, subject, description, priority, status, channel, assigned_agent_id)
VALUES (1, 'TICKET-20240101-1', 1, 1, 'KYC document not verified', 'Customer submitted KYC docs but not verified', 'Medium', 'New', 'Email', 1);

INSERT INTO cs_tickets (ticket_id, ticket_number, customer_id, account_id, subject, description, priority, status, channel, assigned_agent_id)
VALUES (2, 'TICKET-20240101-2', 2, 2, 'Unable to access account', 'Corporate login fails with auth error', 'High', 'In Progress', 'Chat', 2);

INSERT INTO cs_tickets (ticket_id, ticket_number, customer_id, account_id, subject, description, priority, status, channel, assigned_agent_id)
VALUES (3, 'TICKET-20240101-3', 3, 3, 'Loan account showing blocked', 'Loan EMI paid, but blocked warning in app', 'Critical', 'Waiting', 'Mobile App', 3);

INSERT INTO cs_tickets (ticket_id, ticket_number, customer_id, account_id, subject, description, priority, status, channel, assigned_agent_id)
VALUES (4, 'TICKET-20240101-4', 4, 4, 'Credit card payment pending', 'Customer reports payment not updated', 'Low', 'New', 'Phone', 4);

INSERT INTO cs_tickets (ticket_id, ticket_number, customer_id, account_id, subject, description, priority, status, channel, assigned_agent_id)
VALUES (5, 'TICKET-20240101-5', 5, 5, 'Fixed deposit wrongly closed', 'FD closed without consent', 'High', 'Resolved', 'Email', 5);

INSERT INTO cs_tickets (ticket_id, ticket_number, customer_id, account_id, subject, description, priority, status, channel, assigned_agent_id)
VALUES (6, 'TICKET-20240101-6', 6, 6, 'Closed account showing open', 'Savings account shows open after closure', 'Medium', 'Closed', 'Branch', 6);

INSERT INTO cs_tickets (ticket_id, ticket_number, customer_id, account_id, subject, description, priority, status, channel, assigned_agent_id)
VALUES (7, 'TICKET-20240101-7', 7, 7, 'Unable to withdraw cash', 'ATM not dispensing, account debited', 'Critical', 'Cancelled', 'Phone', 7);

INSERT INTO cs_tickets (ticket_id, ticket_number, customer_id, account_id, subject, description, priority, status, channel, assigned_agent_id)
VALUES (8, 'TICKET-20240101-8', 8, 8, 'Loan account missing in app', 'Customer cannot see loan details', 'Medium', 'New', 'Web', 8);

INSERT INTO cs_tickets (ticket_id, ticket_number, customer_id, account_id, subject, description, priority, status, channel, assigned_agent_id)
VALUES (9, 'TICKET-20240101-9', 9, 9, 'Credit card limit reduced', 'Customer not informed before reduction', 'High', 'New', 'Email', 9);

INSERT INTO cs_tickets (ticket_id, ticket_number, customer_id, account_id, subject, description, priority, status, channel, assigned_agent_id)
VALUES (10, 'TICKET-20240101-10', 10, 10, 'Unable to withdraw - savings', 'Customer unable to withdraw even after sufficient funds', 'Medium', 'In Progress', 'Chat', 10);

INSERT INTO cs_ticket_updates (ticket_id, update_text, updated_by)
VALUES (1, 'KYC Pending verification.', 'agent1');

INSERT INTO cs_ticket_updates (ticket_id, update_text, updated_by)
VALUES (2, 'Reset password instructions sent.', 'agent2');

INSERT INTO cs_ticket_updates (ticket_id, update_text, updated_by)
VALUES (3, 'Escalated to backend for loan unblock', 'agent3');

INSERT INTO cs_ticket_updates (ticket_id, update_text, updated_by)
VALUES (4, 'Queued for card operations team', 'agent4');

INSERT INTO cs_ticket_updates (ticket_id, update_text, updated_by)
VALUES (5, 'Customer contacted via phone.', 'agent5');

INSERT INTO cs_ticket_updates (ticket_id, update_text, updated_by)
VALUES (6, 'Account closure confirmed.', 'agent6');

INSERT INTO cs_ticket_updates (ticket_id, update_text, updated_by)
VALUES (7, 'ATM dispute logged. Awaiting response', 'agent7');

INSERT INTO cs_ticket_updates (ticket_id, update_text, updated_by)
VALUES (8, 'Ticket created and assigned', 'agent8');

INSERT INTO cs_ticket_updates (ticket_id, update_text, updated_by)
VALUES (9, 'Complaint acknowledged', 'agent9');

INSERT INTO cs_ticket_updates (ticket_id, update_text, updated_by)
VALUES (10, 'Savings withdrawal issue recreated', 'agent10');

INSERT INTO cs_interactions (ticket_id, channel, message_text, direction, created_by)
VALUES (1, 'Email', 'Welcome, please verify your KYC.', 'Outbound', 'agent1');

INSERT INTO cs_interactions (ticket_id, channel, message_text, direction, created_by)
VALUES (1, 'Email', 'KYC documents attached as requested.', 'Inbound', 'alice@example.com');

INSERT INTO cs_interactions (ticket_id, channel, message_text, direction, created_by)
VALUES (2, 'Chat', 'I am unable to access my corporate account.', 'Inbound', 'contact@betaltd.com');

INSERT INTO cs_interactions (ticket_id, channel, message_text, direction, created_by)
VALUES (2, 'Chat', 'We are looking into your login issue.', 'Outbound', 'agent2');

INSERT INTO cs_interactions (ticket_id, channel, message_text, direction, created_by)
VALUES (3, 'Call', 'Loan account is showing as blocked.', 'Inbound', 'charlie.b@example.com');

INSERT INTO cs_interactions (ticket_id, channel, message_text, direction, created_by)
VALUES (3, 'Call', 'Your issue has been escalated for review.', 'Outbound', 'agent3');

INSERT INTO cs_interactions (ticket_id, channel, message_text, direction, created_by)
VALUES (4, 'Branch', 'I paid my credit card bill but it is not showing.', 'Inbound', 'help@delta.com');

INSERT INTO cs_interactions (ticket_id, channel, message_text, direction, created_by)
VALUES (4, 'Branch', 'Our branch team will contact you for resolution.', 'Outbound', 'agent4');

INSERT INTO cs_interactions (ticket_id, channel, message_text, direction, created_by)
VALUES (5, 'SMS', 'Why was my Fixed Deposit closed?', 'Inbound', 'eve.m@gmail.com');

INSERT INTO cs_interactions (ticket_id, channel, message_text, direction, created_by)
VALUES (5, 'SMS', 'We are investigating your Fixed Deposit issue.', 'Outbound', 'agent5');

COMMIT;
```

### Run Data Model
1. Execute complete SQL script
2. Verify all tables created with sample data

## Lab 3: Create Application with AI

### Application Creation
1. App Builder → Create → Create App Using Generative AI
2. Refresh data dictionary
3. Prompt 1: "Create a customer support portal for a banking customer. Create pages to manage Customers, Accounts, and Tickets."
4. Prompt 2: "Make Tickets searchable using faceted search."
5. Prompt 3: "Add a form page to edit Tickets."
6. Prompt 4: "Add a Dashboard page to track customer support tickets."
7. Upload app icon
8. Create application

## Lab 4: Enhanced Charts

### Pie Chart - Tickets by Status
1. Navigate to Dashboard page
2. SQL Commands → Use APEX Assistant
3. Prompt: "Provide a breakdown of tickets by status"
4. Insert generated SQL into pie chart region

### Bar Chart - Monthly Trends
1. Add new chart region
2. Use APEX Assistant
3. Prompt: "Show the number of tickets created each month over the last 12 months"
4. Configure as bar chart

## Lab 5: UI Enhancement

### Convert to Content Row Layout
1. Page Designer → Tickets page
2. Select report region
3. Layout → Change to Content Row

### Enhance SQL Query
1. Use APEX Assistant
2. Prompt: "Add agent names, account types, customer names to the tickets query"
3. Update report SQL

### Generate HTML Descriptions
1. APEX Assistant
2. Prompt: "Generate HTML for ticket descriptions with formatting"
3. Update display settings

### Add Badges and Styling
1. Add status badges
2. Add priority indicators
3. Theme Roller: Redwood Light, Ocean pillar

## Lab 6: AI-Powered Chat Assistant

### Create AI Configuration
1. Shared Components → AI Configurations → Create
2. Name: Ticket AI Configuration
3. Service: [Your AI service]
4. System Prompt:
   ```
   You are a customer support assistant. Answer questions using the provided ticket data.
   Include customer name, account type, agent name, channel, and status when relevant.
   ```
5. Welcome Message: "Hi! I'm your Ticket Assistant. How can I help you today?"

### Create RAG Source
1. Ticket AI Configuration → RAG Sources → Create
2. Name: Ticket Assistant Source
3. Description: RAG source for customer tickets
4. SQL Query (use APEX Assistant):
   ```sql
   select tt.ticket_number,
          tt.subject,
          tt.description,
          tt.status,
          tt.priority,
          tt.channel,
          ag.agent_name,
          cu.customer_name,
          ac.account_type
     from cs_tickets        tt
     left join cs_agents    ag on tt.assigned_agent_id = ag.agent_id
     left join cs_customers cu on tt.customer_id = cu.customer_id
     left join cs_accounts  ac on tt.account_id = ac.account_id
   ```
5. Server-side Condition: PL/SQL Function Body returning Boolean
   ```sql
   RETURN :APP_PAGE_ID = 5;
   ```

### Add Chat Button
1. Page 3 (or your dashboard page)
2. Create button: TICKET_ASSISTANT
3. Label: Ticket Assistant
4. Icon: fa-headset
5. Create Dynamic Action: Show AI Assistant
6. Configuration: Ticket AI Configuration
7. Welcome Message: "Hi! How can I help you with your tickets today?"
8. Quick Actions:
   - Message 1: "List open high priority tickets"
   - Message 2: "Show tickets assigned to Agent Rita"

## Lab 7: AI Ticket Summary System

### Create Modal Dialog Page
1. App Builder → Create Page → Modal Dialog
2. Page Number: 13
3. Name: Ticket Summary
4. Page Mode: Modal Dialog

### Create Page Items
1. P13_TICKET_ID
   - Type: Hidden
   - Label: (blank)
2. P13_TICKET_SUMMARY
   - Type: Hidden
   - Label: (blank)

### Create Dynamic Content Region
1. Create Sub Region under Body
2. Title: Ticket Summary
3. Type: Dynamic Content
4. PL/SQL Code:
   ```sql
   IF :P13_TICKET_SUMMARY is null then
       return '<span aria-hidden="true" class="fa fa-spinner fa-anim-spin"></span><span> Generating Summary ...</span>';
   else
       return apex_markdown.to_html(:P13_TICKET_SUMMARY);
   END IF;
   ```
5. Page Items to Submit: P13_TICKET_SUMMARY

### Add Close Button
1. Create button in Footer region
2. Button Name: CLOSE_DIALOG
3. Label: Close
4. Template: Text
5. Create Dynamic Action: Close Dialog

### Configure AI Generation
1. Page Load Dynamic Action
2. Action 1: Generate Text with AI
   - Configuration: Ticket AI Configuration
   - Input Value Type: Only System Prompt
   - Use Response: Item - P13_TICKET_SUMMARY
3. Action 2: Refresh
   - Region: Ticket Summary (Dynamic Content region)

### Create RAG Source
1. Shared Components → AI Configurations → Ticket AI Configuration
2. RAG Sources → Create
3. Name: Ticket Summary Details
4. Description: Retrieve comprehensive ticket details for summary generation
5. SQL Query:
   ```sql
   select t.ticket_number,
          t.subject,
          t.description,
          t.status,
          t.priority,
          t.channel,
          ag.agent_name,
          c.customer_name,
          a.account_type,
          (select count(*) from cs_interactions i where i.ticket_id = t.ticket_id) as interaction_count
     from cs_tickets t
     join cs_customers c on c.customer_id = t.customer_id
     left join cs_accounts a on a.account_id = t.account_id
     left join cs_agents ag on ag.agent_id = t.assigned_agent_id
    where t.ticket_id = :P13_TICKET_ID
   ```
6. Server-side Condition: PL/SQL Function Body returning Boolean
   ```sql
   RETURN :APP_PAGE_ID = 13;
   ```

### Add Navigation Action
1. Page 5 (Ticket Finder) → Tickets region
2. Right-click Actions → Create Action
3. Position: Primary Actions
4. Template: Button
5. Label: Generate Ticket Summary
6. Type: Redirect to Page
7. Icon: fa-info-circle
8. Target Page: 13
9. Set Items: P13_TICKET_ID = &TICKET_ID.

## Testing

1. Run application
2. Navigate to ticket finder (Page 5)
3. Click "Generate Ticket Summary" button
4. Verify modal opens with loading spinner
5. Confirm summary generates and displays formatted text
6. Test close functionality
